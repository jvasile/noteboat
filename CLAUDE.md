# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

Noteboat is a linked note-taking application with a hierarchical type system. It
supports creating, editing, browsing, and searching notes with automatic
CamelCase link detection. The data model is document-based and adopts some
elements of JSON-LD.  Notes are hierarchically typed with defined schemas.

The base type is the note.  It has a title, mtime, editors, and text.  The text
field is markdown and allows for linking to another note.  It also has some
metadata:  @type, which is a list of the current type and parent types. @id
should contain a guid for the object. 

## Architecture

Data is stored in directories.  The directory hierarchy is not semantically
significant.  Instead, we identify notes by title, no matter where they might be
found.

Notes might be edited on different computers, which makes syncing necessary.
Note mtime and @id can be used to manage versions but we need to work on away to
resolve conflicts.  We will have to make a sync/storage server or other
mechanism.

**UI Navigation Flow**:
1. **List View**: Shows all notes. Clicking a note enters View mode
2. **View Mode** (default): Displays single note with rendered content. Tags and links are clickable and navigate to other notes. Has Edit and Back buttons.  Default note to display is "Main".  If no such note exists, create it and start in edit mode for that note.
3. **Edit Mode**: Form for editing note. Save returns to View mode, Cancel returns to View mode, Preview shows edit mode but does not save.

Clicking a link in View mode loads and displays the target note.  Clicking a tag
loads and displays the list of notes that match the tag.

Extract the links and tags from the text and other data structure fields and
cache them as "_links" and "_tags".  These are derived fields and should never
be user-editable.  They can be stored, but should be updated any time the data
fields are edited.

By default, storage operations use first directory in the list of directories
for writes. Although we borrow from JSON-LD, we don't store as JSON.  Instead,
notes are saved as `.md` files with YAML frontmatter by default. The frontmatter
contains metadata (title, mtime, extra fields), while the markdown body contains
the note text.  It is possible that a note file on disk will be stored as JSON
or another format instead of YAML.  For example, it might be generated by a
different app.  In that case, we read and write it in whatever format we found
it in.

Search functionality matches against all fields with case-insensitive
comparison.

It is possible we have two notes with the same title but different @id.  We
might even have two notes with the same title, different @id, and different
@type.  In these cases, any attempt to navigate to one of these notes should be
interrupted with a disambiguation step added to the user flow.

## Testing

The codebase includes comprehensive unit tests for core functionality.

